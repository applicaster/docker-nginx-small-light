version: "3"
services:
  nginx:
    build: .
    networks:
      nginx_small_light:
        ipv4_address: 192.168.33.2
    ports:
      - <%= @server_port %>:80
      - 443
    environment:
      UPSTREAM_BASE_URL: <%= "http://192.168.33.1:#{@images_port}" %>
  image_server:
    image: cannin/nodejs-http-server
    networks:
      nginx_small_light:
        ipv4_address: 192.168.33.3
    ports:
      - <%= @images_port %>:8080
    volumes:
      - ./spec/fixtures:/home
    command: http-server -od --cors /home
networks:
    nginx_small_light:
        external:
            name: nginx_small_light
